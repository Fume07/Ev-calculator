<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forbedret Polymarket EV-Kalkulator</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        input, select, button {
            font-size: 16px;
        }
        input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }
        .calculate-btn {
            width: 100%;
            padding: 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px 0;
            font-weight: bold;
        }
        .calculate-btn:hover {
            background-color: #2980b9;
        }
        .results {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            display: none;
        }
        .result-item {
            margin: 10px 0;
            padding: 8px;
            background-color: white;
            border-radius: 3px;
        }
        .positive {
            background-color: #d5f4e6;
            color: #27ae60;
        }
        .negative {
            background-color: #fdf2f2;
            color: #e74c3c;
        }
        .neutral {
            background-color: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
<div class="container">
<h1>ðŸ“Š Forbedret Polymarket EV-Kalkulator</h1>

<form id="evCalc" autocomplete="off">
    <div class="input-group">
        <label for="bookOdds">Bookmaker odds (desimal):</label>
        <input type="text" id="bookOdds" placeholder="2.0">
    </div>

    <div class="input-group">
        <label for="payout">Bookmaker payout (%):</label>
        <input type="text" id="payout" placeholder="92.5">
    </div>

    <div class="input-group">
        <label for="pmPrice">Polymarket pris (cent):</label>
        <input type="text" id="pmPrice" placeholder="56">
    </div>

    <div class="input-group">
        <label for="positionType">Posisjonstype:</label>
        <select id="positionType">
            <option value="yes">YES (betaler $1 hvis utfallet skjer)</option>
            <option value="no">NO (tjener $1 hvis utfallet ikke skjer)</option>
        </select>
    </div>

    <div class="input-group">
        <label for="stake">Innsats (USD):</label>
        <input type="text" id="stake" placeholder="100">
    </div>

    <button type="button" class="calculate-btn" onclick="calculateEV()">ðŸ§® Beregn EV</button>
</form>

<div id="results" class="results">
    <div id="adjOdds" class="result-item"></div>
    <div id="probability" class="result-item"></div>
    <div id="sharePrice" class="result-item"></div>
    <div id="numShares" class="result-item"></div>
    <div id="pnlWin" class="result-item"></div>
    <div id="pnlLoss" class="result-item"></div>
    <div id="evShare" class="result-item"></div>
    <div id="evDollar" class="result-item"></div>
    <div id="totalEV" class="result-item"></div>
    <div id="evPct" class="result-item"></div>
    <div id="recommend" class="result-item"></div>
</div>

</div>

<script>

function val(v) {
    if (v === undefined || v === null) return NaN;
    v = v.toString().trim().replace(",", ".");
    return parseFloat(v);
}

function calculateEV() {
    const odds = val(document.getElementById("bookOdds").value);
    const payout = val(document.getElementById("payout").value);
    const priceCents = val(document.getElementById("pmPrice").value);
    const stake = val(document.getElementById("stake").value);
    const position = document.getElementById("positionType").value;

    if ([odds, payout, priceCents, stake].some(v => isNaN(v))) {
        document.getElementById("results").style.display = "none";
        return;
    }

    const pmPrice = priceCents / 100; // Pris 0â€“1
    const adjOdds = odds / (payout / 100);
    const trueProb = 1 / adjOdds;

    // Price depends on YES or NO
    let shareCost;
    let payoutIfWin;
    let feeMultiplier = 1;

    if (position === "yes") {
        shareCost = pmPrice;
        payoutIfWin = 1;
        feeMultiplier = 0.98; // 2% fee
    } else {
        shareCost = 1 - pmPrice;
        payoutIfWin = 1;  // NO pays 1 if outcome does NOT occur
        feeMultiplier = 1.00; // NO has no fees
    }

    const shares = stake / shareCost;

    const winReturn = payoutIfWin * feeMultiplier * shares;
    const winProfit = winReturn - stake;
    const lossAmount = stake;

    const fairValue = trueProb * payoutIfWin * feeMultiplier;  
    const evPerShare = fairValue - shareCost;
    const totalEV = evPerShare * shares;
    const evPerDollar = totalEV / stake;
    const evPercent = evPerDollar * 100;

    // Render results
    document.getElementById("adjOdds").innerHTML =
        `<strong>Edge-justerte odds:</strong> ${adjOdds.toFixed(3)}`;

    document.getElementById("probability").innerHTML =
        `<strong>Implisitt sannsynlighet:</strong> ${(trueProb * 100).toFixed(2)}%`;

    document.getElementById("sharePrice").innerHTML =
        `<strong>Pris per kontrakt (${position.toUpperCase()}):</strong> $${shareCost.toFixed(2)}`;

    document.getElementById("numShares").innerHTML =
        `<strong>Antall kontrakter:</strong> ${shares.toFixed(2)}`;

    document.getElementById("pnlWin").innerHTML =
        `<strong>Gevinst ved seier:</strong> $${winProfit.toFixed(2)} (utbetaling: $${winReturn.toFixed(2)})`;

    document.getElementById("pnlLoss").innerHTML =
        `<strong>Tap ved tap:</strong> $${lossAmount.toFixed(2)}`;

    document.getElementById("evShare").innerHTML =
        `<strong>EV per kontrakt:</strong> $${evPerShare.toFixed(4)}`;

    document.getElementById("evDollar").innerHTML =
        `<strong>EV per USD risiko:</strong> ${evPercent.toFixed(2)}%`;

    const evEl = document.getElementById("totalEV");
    evEl.innerHTML = `<strong>Total EV:</strong> $${totalEV.toFixed(2)}`;
    evEl.className =
        totalEV > 0 ? "result-item positive" :
        totalEV < 0 ? "result-item negative" :
        "result-item neutral";

    const pctEl = document.getElementById("evPct");
    pctEl.innerHTML = `<strong>EV %:</strong> ${evPercent.toFixed(2)}%`;
    pctEl.className = evEl.className;

    // Recommendation logic
    const recEl = document.getElementById("recommend");
    let text, className;

    if (evPercent > 5) {
        text = "ðŸŸ¢ Sterkt positivt EV â€“ veldig god verdi.";
        className = "result-item positive";
    } else if (evPercent > 1) {
        text = "ðŸŸ¡ Moderat positivt EV â€“ muligens bra bet.";
        className = "result-item neutral";
    } else if (evPercent > -1) {
        text = "ðŸŸ¡ NÃ¸ytral/close to breakeven â€“ vÃ¦r selektiv.";
        className = "result-item neutral";
    } else {
        text = "ðŸ”´ Negativ EV â€“ ikke anbefalt.";
        className = "result-item negative";
    }

    recEl.innerHTML = text;
    recEl.className = className;

    document.getElementById("results").style.display = "block";
}

</script>
</body>
</html>


